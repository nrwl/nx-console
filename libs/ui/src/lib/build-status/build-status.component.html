<div class="container">
  <div class="row summary" fxLayout="row" fxLayoutGap="20px">
    <mat-card fxFlex>
      <div class="header">
        <h3>Summary</h3>
      </div>
      <div class="grid grid-3-columns">
        <div>
          <div class="title">Status</div>
          <div class="content">
            {{ buildStatus$ | async }}
            <small *ngIf="(status$ | async)?.time as time">({{ time }})</small>
          </div>
        </div>
        <div class="summary-errors">
          <div class="title">Errors</div>
          <div class="content">
            <ng-container *ngIf="(errors$ | async) as errors; else noErrors">
              {{ errors.length > 0 ? 'Present' : 'None' }}
            </ng-container>
            <ng-template #noErrors>
              None
            </ng-template>
          </div>
        </div>
        <div class="summary-warnings">
          <div class="title">Warnings</div>
          <div class="content">
            <ng-container
              *ngIf="(warnings$ | async) as warnings; else noWarnings"
            >
              {{ warnings.length > 0 ? 'Present' : 'None' }}
            </ng-container>
            <ng-template #noWarnings>
              None
            </ng-template>
          </div>
        </div>
        <div>
          <div class="title">Assets</div>
          <div class="content">
            {{ (summary$ | async)?.assets.gzipped | formatFileSize: '–' }}
            <small>(Gzipped)</small>
          </div>
        </div>
        <div>
          <div class="title">Modules</div>
          <div class="content">
            {{ (summary$ | async)?.modules | formatFileSize: '–' }}
            <small>(Parsed)</small>
          </div>
        </div>
      </div>
    </mat-card>
    <mat-card class="build-status">
      <ng-container *ngIf="(serverUrl$ | async) as serverUrl; else buildResult">
        <div class="status-icon-container">
          <mat-icon class="success">check_circle</mat-icon>
        </div>
        <div class="build-status-content">
          <button
            mat-raised-button
            color="primary"
            (click)="onServerOpen(serverUrl)"
          >
            <mat-icon>launch</mat-icon>
            Open App
          </button>
        </div>
      </ng-container>
      <ng-template #buildResult>
        <div class="status-icon-container">
          <mat-icon [ngClass]="buildStatusClass$ | async">{{
            buildStatusIcon$ | async
          }}</mat-icon>
        </div>
        <div class="build-status-content">
          <ng-container
            *ngIf="
              (openableOutputPath$ | async) as outputPath;
              else buildStatus
            "
          >
            <button
              mat-raised-button
              color="primary"
              (click)="showItemInFolder(outputPath)"
            >
              <mat-icon>folder_open</mat-icon>
              Open Folder
            </button>
          </ng-container>
          <ng-template #buildStatus>
            {{ detailedBuildStatus$ | async }}
          </ng-template>
        </div>
      </ng-template>
    </mat-card>
  </div>
  <div
    [ngClass]="'row ' + (problemsAnimationState$ | async)"
    [@growShrinkVert]="problemsAnimationState$ | async"
  >
    <mat-card>
      <div class="header" fxLayout="row" fxLayoutAlign="center">
        <div fxFlex>
          <h3>Problems</h3>
        </div>
      </div>
      <ng-container *ngIf="(errors$ | async) as errors">
        <div class="problem-list">
          <div
            class="problem-list-item"
            *ngFor="let error of errors; trackBy: trackByString"
          >
            {{ error }}
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="(warnings$ | async) as warnings">
        <div class="problem-list">
          <div
            class="problem-list-item"
            *ngFor="let warning of warnings; trackBy: trackByString"
          >
            {{ warning }}
          </div>
        </div>
      </ng-container>
    </mat-card>
  </div>
  <div
    class="row"
    [ngClass]="'row ' + (analyzeAnimationState$ | async)"
    [@growShrinkVert]="analyzeAnimationState$ | async"
  >
    <mat-card>
      <div class="header" fxLayout="row" fxLayoutAlign="center">
        <div fxFlex>
          <h3>Analyze</h3>
        </div>
        <div class="actions" fxLayout="row" fxLayoutGap="20px">
          <mat-select
            matRipple
            fxFlex
            [value]="currentChunkId$ | async"
            (selectionChange)="handleChunkFileSelection($event)"
          >
            <mat-option
              *ngFor="let chunk of (chunks$ | async); trackBy: trackById"
              [value]="chunk.id"
            >
              {{ chunk.file }}
            </mat-option>
          </mat-select>
        </div>
      </div>
      <ng-container
        *ngIf="
          (viewingModules$ | async) as viewingModules;
          else noViewingModules
        "
      >
        <ui-modules-graph
          [chunk]="currentChunk$ | async"
          [data]="viewingModules"
        ></ui-modules-graph>
      </ng-container>
      <ng-template #noViewingModules>
        <mat-icon class="pending large">more_horiz</mat-icon>
      </ng-template>
    </mat-card>
  </div>
  <div class="row">
    <mat-card>
      <div class="header" fxLayout="row" fxLayoutAlign="center">
        <div fxFlex>
          <h3>Speed Stats</h3>
        </div>
      </div>
      <ng-container
        *ngIf="(networkSpeeds$ | async) as speedStats; else noSpeedStats"
      >
        <div class="grid grid-4-columns">
          <div *ngFor="let stat of speedStats; trackBy: trackBySpeedKey">
            <div class="title">
              {{ stat.label }}
            </div>
            <div class="content">
              {{ stat.downloadTime }}
            </div>
          </div>
        </div>
      </ng-container>
      <ng-template #noSpeedStats>
        <mat-icon class="pending large">more_horiz</mat-icon>
      </ng-template>
    </mat-card>
  </div>
  <div class="row">
    <mat-card>
      <div class="header" fxLayout="row" fxLayoutAlign="center">
        <div fxFlex>
          <h3>Assets</h3>
        </div>
      </div>
      <mat-grid-list cols="6" rowHeight="28px">
        <mat-grid-tile class="title" colspan="2"></mat-grid-tile>
        <mat-grid-tile class="title" colspan="1">Gzipped</mat-grid-tile>
        <mat-grid-tile
          class="title"
          colspan="1"
          *ngFor="let key of displayAssetSpeeds; trackBy: trackByString"
        >
          {{ getSpeedLabel(key) }}
        </mat-grid-tile>
      </mat-grid-list>
      <ng-container
        *ngIf="(displayAssets$ | async) as displayAssets; else noDisplayAssets"
      >
        <ng-container *ngIf="displayAssets.length > 0; else noDisplayAssets"
          ><mat-grid-list
            cols="6"
            rowHeight="28px"
            *ngFor="let asset of displayAssets; trackBy: trackByAsset"
          >
            <mat-grid-tile colspan="2">
              <div class="asset-name">{{ asset.name }}</div>
            </mat-grid-tile>
            <mat-grid-tile colspan="1">
              <div
                class="content"
                matTooltipPosition="right"
                matTooltip="{{
                  asset.sizes.parsed | formatFileSize: '-'
                }} (Parsed)"
              >
                {{ asset.sizes.gzipped | formatFileSize: '–' }}
              </div>
            </mat-grid-tile>
            <mat-grid-tile
              colspan="1"
              *ngFor="let speedStat of asset.speeds; trackBy: trackBySpeedKey"
            >
              <div class="content">{{ speedStat.downloadTime }}</div>
            </mat-grid-tile>
          </mat-grid-list>
        </ng-container>
      </ng-container>
      <ng-template #noDisplayAssets>
        <mat-icon class="pending large">more_horiz</mat-icon>
      </ng-template>
    </mat-card>
  </div>
</div>
