<div class="filter-container" fxLayout="row" fxLayoutAlign="start center">
  <input
    placeholder="Filter projects"
    #projectFilter
    fxFlex
    [formControl]="projectFilterFormControl"
    id="filter"
  />
  <mat-icon
    class="filter-icon"
    (click)="projectFilterFormControl.setValue(''); projectFilter.select()"
  >
    {{ projectFilterFormControl.value ? 'clear' : 'filter_list' }}
  </mat-icon>
</div>
<mat-list dense *ngIf="(filteredProjects$ | async) as projects">
  <cdk-virtual-scroll-viewport
    *ngIf="(viewportHeight$ | async) as viewportHeight"
    [style.height]="viewportHeight"
    itemSize="76"
    class="field-viewport"
  >
    <ui-entity-docs [docs]="docs$ | async"></ui-entity-docs>

    <ng-container *ngIf="(filteredProjects$ | async) as projects">
      <div cdkVirtualScrollContent>
        <ng-container
          *cdkVirtualFor="let p of projects; trackBy: trackByProjectRoot"
        >
          <mat-list-item
            class="favorite-icon"
            [ngClass]="p.projectType"
            [disableRipple]="true"
          >
            <mat-icon
              (click)="onPinClick(p); $event.stopPropagation()"
              mat-list-icon
              *ngIf="!pinnedProjectNames.includes(p.name)"
              class="favorite-icon"
            >
              favorite_border
            </mat-icon>
            <mat-icon
              (click)="onPinClick(p); $event.stopPropagation()"
              mat-list-icon
              *ngIf="pinnedProjectNames.includes(p.name)"
              class="favorite-icon favorited"
              >favorite</mat-icon
            >
            <div class="project-type" mat-line>{{ p.projectType }}</div>
            <div class="project-name" mat-line>{{ p.name }}</div>
            <div class="project-root" mat-line *ngIf="p.root">
              <mat-icon>folder_open</mat-icon>
              {{ p.root }}
            </div>
            <div
              fxFlex="grow"
              fxLayout="row wrap"
              fxLayoutGap="12px"
              fxLayoutAlign="end"
              class="project-action-button-container"
            >
              <button
                *ngFor="let a of p.actions"
                mat-stroked-button
                [routerLink]="a.link"
                class="route-button"
              >
                {{ a.actionDescription | titlecase }}
              </button>
              <button
                mat-stroked-button
                #actionsMenuTrigger="matMenuTrigger"
                [matMenuTriggerFor]="actionsMenu"
                [matMenuTriggerData]="{ project: p }"
                [disabled]="!p.supportsGenerate"
              >
                Generate
              </button>
            </div>
          </mat-list-item>
          <mat-divider></mat-divider>
        </ng-container>
      </div>
    </ng-container>
  </cdk-virtual-scroll-viewport>
</mat-list>

<mat-menu #actionsMenu>
  <ng-template matMenuContent let-p="project">
    <div
      class="filter-container"
      fxLayout="row"
      fxLayoutAlign="start center"
      (click)="$event.stopPropagation()"
      (keydown)="$event.stopPropagation()"
    >
      <input
        placeholder="Filter schematics"
        #schematicFilter
        fxFlex
        [formControl]="schematicFilterFormControl"
        id="filter"
      />
      <mat-icon
        class="filter-icon"
        (click)="
          schematicFilterFormControl.setValue(''); schematicFilter.select()
        "
      >
        {{ schematicFilterFormControl.value ? 'clear' : 'filter_list' }}
      </mat-icon>
    </div>
    <ng-container *ngFor="let a of (p.links$ | async)">
      <ng-container *ngIf="!a.link">
        <mat-divider></mat-divider>
        <span mat-menu-item [disabled]="true"> {{ a.actionDescription }} </span>
        <mat-divider></mat-divider>
      </ng-container>
      <button mat-menu-item [routerLink]="a.link" *ngIf="a.link">
        {{ a.actionDescription | titlecase }}
      </button>
    </ng-container>
  </ng-template>
</mat-menu>
