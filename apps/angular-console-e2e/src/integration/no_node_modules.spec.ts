import {
  checkMessage,
  clickOnTask,
  goToGenerate,
  goToTasks,
  openProject,
  projectNames,
  projectPath,
  taskListHeaders,
  texts,
  whitelistGraphql
} from './utils';
import { toggleRecentTasksExpansion, clearAllRecentTasks } from './tasks.utils';

describe('Project without node modules', () => {
  beforeEach(() => {
    whitelistGraphql();
    cy.visit('/workspaces');
    openProject(projectPath('proj-no-node-modules'));
  });

  it('partially works', () => {
    cy.contains('proj-no-node-modules');

    // projects screen loads
    projectNames($p => {
      expect($p.length).to.equal(2);
      expect(texts($p)[0]).to.contain('proj-no-node-modules');
      expect(texts($p)[1]).to.contain('proj-no-node-modules-e2e');
    });

    goToTasks();
    cy.get('div.title').contains('Run Tasks');

    // renders list of tasks
    cy.get('div.title').contains('Run Tasks');
    taskListHeaders($p => {
      expect($p.length).to.equal(3);
      expect(texts($p)[1]).to.equal('proj-no-node-modules');
    });

    // doesn't render individual task
    clickOnTask('proj-no-node-modules', 'build');
    checkMessage('node_modules is not found');

    // doesn't render list of schematics
    goToGenerate();
    checkMessage('node_modules is not found');
  });
});
