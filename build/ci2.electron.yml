steps:
  - task: NodeTool@0
    displayName: install node.js
    inputs:
      versionSpec: '12.x'

  - task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreAndSaveCacheV1.RestoreAndSaveCache@1
    displayName: download cache
    inputs:
      keyfile: '**/yarn.lock, !**/node_modules/**/yarn.lock, !**/.*/**/yarn.lock'
      targetfolder: '**/node_modules, !**/node_modules/**/node_modules, ~/.cache/Cypress'
      vstsFeed: 'angular-console-ubuntu-16.04'

  - script: |
      yarn install --ignore-engines --frozen-lockfile
    displayName: 'yarn install'
    condition: ne(variables['CacheRestored'], 'true')

  - script: |
      yarn start prepare.electron
    displayName: build electron

  - script: |
      yarn start e2e.ci2.fixtures
    displayName: e2e fixtures (ci2)

  - script: |
      yarn start e2e.ci2
    displayName: e2e tests (ci2)
